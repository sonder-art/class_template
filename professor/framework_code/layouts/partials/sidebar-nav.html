{{/*
FRAMEWORK NAVIGATION COMPONENT
Dynamic Sidebar Navigation for GitHub Class Template Framework
Automatically generates navigation tree from content structure including:
- Numbered chapters (01_, 02_, etc.) 
- Appendix chapters (A_, B_, etc.)
- Current page highlighting
- Collapsible sections
- VSCode-style file tree

This component provides ALL navigation logic and structure.
Theme only provides CSS styling for visual appearance.
*/}}

<nav class="sidebar-nav" data-current-section="{{ .Section }}">
    <!-- Framework Profile Section -->
    <div class="nav-profile">
        <div class="profile-image">
            {{ $profileImage := .Site.Params.profile_image | default "/assets/images/profile-placeholder.svg" }}
            <img src="{{ $profileImage }}" alt="{{ .Site.Params.professor_name | default "Instructor" }}" class="profile-avatar">
        </div>
        <div class="profile-info">
            <h3 class="profile-name">{{ .Site.Params.professor_name | default "Instructor" }}</h3>
            <p class="profile-role">{{ .Site.Params.course_name | default "Course" }}</p>
        </div>
    </div>
    
    <!-- Framework Utility Icons -->
    <div class="nav-utilities">
        <a href="{{ relURL "/" }}" class="utility-btn" title="Home">
            <span class="utility-icon">üè†</span>
        </a>
        <button class="utility-btn" title="Search (Coming Soon)" disabled>
            <span class="utility-icon">üîç</span>
        </button>
        <button class="utility-btn" title="Font Settings (Coming Soon)" disabled>
            <span class="utility-icon">üî§</span>
        </button>
    </div>
    
    <!-- Authentication & Navigation Section -->
    {{ if .Site.Params.authentication.enabled }}
    <div class="nav-auth-section">
        <!-- User Status Display -->
        <div class="nav-user-status" id="navUserStatus">
            <span id="userStatusText">üîÑ Checking...</span>
        </div>
        
        <!-- Dashboard Button (visible to authenticated users) -->
        <a href="{{ .Site.BaseURL }}dashboard/" 
           class="nav-auth-btn dashboard-btn" 
           id="navDashboardBtn"
           style="display: none;"
           title="Go to Dashboard">
            üìä Dashboard
        </a>
        
        <!-- Login/Logout Button -->
        <button class="nav-auth-btn auth-btn" 
                id="navAuthToggleBtn"
                title="Login to access features">
            Login
        </button>
    </div>
    {{ end }}
    
    <!-- Framework File Tree Generation -->
    {{/* Define content categories from framework configuration */}}
    {{ $categories := slice "class_notes" "framework_tutorials" "framework_documentation" }}
    
    <div class="file-tree">
        {{ range $categories }}
            {{ $categoryName := . }}
            {{ $categoryPages := where $.Site.RegularPages "Section" $categoryName }}
            
            {{ if $categoryPages }}
                {{ $categoryTitle := $categoryName | replaceRE "_" " " | title }}
                
                {{/* Framework Category Folder Logic */}}
                <div class="folder-item" data-category="{{ $categoryName }}">
                    <div class="folder-header" data-target="category-{{ $categoryName }}">
                        <span class="folder-icon">‚ñ∂</span>
                        <a href="{{ relURL (printf "%s/00_master_index/" $categoryName) }}" class="folder-name-link {{ if and (eq $.Section $categoryName) (eq $.File.BaseFileName "00_master_index") }}active{{ end }}">
                            <span class="folder-name">{{ $categoryTitle }}</span>
                        </a>
                    </div>
                    
                    <div class="folder-content" id="category-{{ $categoryName }}">
                
                        {{/* Framework Chapter Discovery and Sorting Logic */}}
                        {{ $chapterDirs := slice }}
                        {{ range $categoryPages }}
                            {{ $dir := path.Dir .File.Path }}
                            {{ $dirName := path.Base $dir }}
                            {{ if ne $dirName $categoryName }}
                                {{ if not (in $chapterDirs $dirName) }}
                                    {{ $chapterDirs = $chapterDirs | append $dirName }}
                                {{ end }}
                            {{ end }}
                        {{ end }}
                        
                        {{/* Framework Numbered vs Appendix Chapter Separation */}}
                        {{ $numberedChapters := slice }}
                        {{ $appendixChapters := slice }}
                        
                        {{ range $chapterDirs }}
                            {{ if findRE "^[A-Z]_" . }}
                                {{ $appendixChapters = $appendixChapters | append . }}
                            {{ else }}
                                {{ $numberedChapters = $numberedChapters | append . }}
                            {{ end }}
                        {{ end }}
                        
                        {{/* Framework Numeric Sorting Algorithm for Chapters */}}
                        {{ $sortedNumbered := slice }}
                        {{ range seq 0 99 }}
                            {{ $num := . }}
                            {{ $paddedNum := printf "%02d_" $num }}
                            {{ $unpadded := printf "%d_" $num }}
                            {{ range $numberedChapters }}
                                {{ if or (hasPrefix . $paddedNum) (hasPrefix . $unpadded) }}
                                    {{ if not (in $sortedNumbered .) }}
                                        {{ $sortedNumbered = $sortedNumbered | append . }}
                                    {{ end }}
                                {{ end }}
                            {{ end }}
                        {{ end }}
                        
                        {{/* Framework Appendix Chapter Sorting */}}
                        {{ $appendixChapters = sort $appendixChapters }}
                        
                        {{/* Framework Chapter Order: Numbered first, then appendices */}}
                        {{ $chapterDirs = slice }}
                        {{ range $sortedNumbered }}
                            {{ $chapterDirs = $chapterDirs | append . }}
                        {{ end }}
                        {{ range $appendixChapters }}
                            {{ $chapterDirs = $chapterDirs | append . }}
                        {{ end }}
                        
                        {{ range $chapterDirs }}
                            {{ $chapterName := . }}
                            {{ $chapterPages := where $categoryPages "File.Dir" "eq" (printf "%s/%s/" $categoryName $chapterName) }}
                            {{ $chapterTitle := $chapterName | replaceRE "^([0-9]+|[A-Z])_" "$1. " | replaceRE "_" " " | title }}
                            
                            {{/* Framework Chapter Folder Logic */}}
                            <div class="chapter-item">
                                <div class="chapter-header" data-target="chapter-{{ $categoryName }}-{{ $chapterName }}">
                                    <span class="chapter-icon">‚ñ∂</span>
                                    {{ $isChapterIndex := and (eq $.Section $categoryName) (eq (path.Base (path.Dir $.File.Path)) $chapterName) (eq $.File.BaseFileName "00_index") }}
                                    <a href="{{ relURL (printf "%s/%s/00_index/" $categoryName ($chapterName | lower)) }}" class="chapter-name-link {{ if $isChapterIndex }}active{{ end }}">
                                        <span class="chapter-name">{{ $chapterTitle }}</span>
                                    </a>
                                </div>
                                
                                <div class="chapter-content" id="chapter-{{ $categoryName }}-{{ $chapterName }}">
                                    {{/* Framework Page Sorting Logic within Chapters */}}
                                    {{ $sortedPages := slice }}
                                    {{ $appendixPages := slice }}
                                    
                                    {{/* Framework Numbered vs Appendix Page Separation */}}
                                    {{ range $chapterPages }}
                                        {{ if not (eq .File.BaseFileName "00_index") }}
                                            {{ if findRE "^[A-Z]_" .File.BaseFileName }}
                                                {{ $appendixPages = $appendixPages | append . }}
                                            {{ else }}
                                                {{ $sortedPages = $sortedPages | append . }}
                                            {{ end }}
                                        {{ end }}
                                    {{ end }}
                                    
                                    {{/* Framework Numeric Sorting Algorithm for Pages */}}
                                    {{ $finalSortedPages := slice }}
                                    {{ range seq 0 99 }}
                                        {{ $num := . }}
                                        {{ $paddedNum := printf "%02d_" $num }}
                                        {{ $unpadded := printf "%d_" $num }}
                                        {{ range $sortedPages }}
                                            {{ if or (hasPrefix .File.BaseFileName $paddedNum) (hasPrefix .File.BaseFileName $unpadded) }}
                                                {{ if not (in $finalSortedPages .) }}
                                                    {{ $finalSortedPages = $finalSortedPages | append . }}
                                                {{ end }}
                                            {{ end }}
                                        {{ end }}
                                    {{ end }}
                                    
                                    {{/* Framework Appendix Page Sorting */}}
                                    {{ $appendixPages = sort $appendixPages "File.BaseFileName" }}
                                    
                                    {{/* Framework Page Order: Numbered first, then appendices */}}
                                    {{ $allSortedPages := slice }}
                                    {{ range $finalSortedPages }}
                                        {{ $allSortedPages = $allSortedPages | append . }}
                                    {{ end }}
                                    {{ range $appendixPages }}
                                        {{ $allSortedPages = $allSortedPages | append . }}
                                    {{ end }}
                                    
                                    {{ range $allSortedPages }}
                                        {{ $fileName := .File.BaseFileName | replaceRE "^([0-9]+|[A-Z])_" "$1. " | replaceRE "_" " " | title }}
                                        <div class="file-item {{ if eq $.RelPermalink .RelPermalink }}active{{ end }}">
                                            <a href="{{ .RelPermalink }}" class="file-link">
                                                <span class="file-name">{{ $fileName }}</span>
                                                {{ if .Params.estimated_time }}
                                                    <span class="file-time">{{ .Params.estimated_time }}</span>
                                                {{ end }}
                                            </a>
                                        </div>
                                    {{ end }}
                                </div>
                            </div>
                        {{ end }}
                    </div>
                </div>
            {{ end }}
        {{ end }}
    </div>
</nav> 