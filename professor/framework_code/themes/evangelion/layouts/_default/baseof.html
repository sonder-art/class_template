<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ if .Title }}{{ .Title }} - {{ end }}{{ .Site.Title }}</title>
    
    <!-- Framework CSS -->
    {{ $mainCSS := resources.Get "css/main.css" }}
    {{ if $mainCSS }}
        <link rel="stylesheet" href="{{ $mainCSS.RelPermalink }}">
    {{ end }}
    
    <!-- Theme CSS -->
    {{ $themeCSS := resources.Get "theme/theme.css" }}
    {{ if $themeCSS }}
        <link rel="stylesheet" href="{{ $themeCSS.RelPermalink }}">
    {{ end }}
    
    <!-- Page Description -->
    {{ if .Description }}
        <meta name="description" content="{{ .Description }}">
    {{ else if .Summary }}
        <meta name="description" content="{{ .Summary }}">
    {{ else if .Site.Params.description }}
        <meta name="description" content="{{ .Site.Params.description }}">
    {{ end }}
    
    <!-- Accessibility Features -->
    <meta name="color-scheme" content="dark light">
</head>
<body class="site-container{{ if .Site.Params.default_font }} font-{{ .Site.Params.default_font }}{{ end }}{{ if .Site.Params.high_contrast }} high-contrast{{ end }}">
    <!-- Navigation Toggle Button -->
    <button class="nav-toggle-btn" 
            id="navToggle" 
            aria-label="Toggle navigation menu"
            aria-expanded="true"
            aria-controls="siteNavigation">
        <span class="nav-toggle-icon">
            <span class="nav-toggle-line"></span>
            <span class="nav-toggle-line"></span>
            <span class="nav-toggle-line"></span>
        </span>
    </button>
    
    <!-- Navigation Overlay for Mobile -->
    <div class="nav-overlay" id="navOverlay"></div>
    
    <header class="site-header">
        <div class="header-content">
            <h1><a href="{{ .Site.BaseURL }}">{{ .Site.Title }}</a></h1>
            
            <!-- Breadcrumb Navigation (shows when sidebar is collapsed) -->
            <nav class="breadcrumb-nav" id="breadcrumbNav">
                <span class="breadcrumb-current"></span>
            </nav>
            
            <nav class="main-nav">
                {{ range .Site.Menus.main }}
                    <a href="{{ .URL }}" {{ if $.IsMenuCurrent "main" . }}class="active"{{ end }}>{{ .Name }}</a>
                {{ end }}
            </nav>
        </div>
    </header>
    
    <aside class="site-sidebar" id="siteNavigation" role="navigation">
        {{ block "sidebar" . }}
            {{ partial "sidebar-nav.html" . }}
        {{ end }}
    </aside>
    
    <main class="site-main content">
        {{ block "main" . }}{{ end }}
    </main>
    
    <footer class="site-footer">
        <p>&copy; {{ now.Year }} {{ .Site.Params.course_name }} - {{ .Site.Params.professor_name }}</p>
        {{ if .Site.Params.contact_policy }}
            <p>{{ .Site.Params.contact_policy }}</p>
        {{ end }}
    </footer>

    <!-- Collapsible Navigation JavaScript -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const navToggle = document.getElementById('navToggle');
        const navOverlay = document.getElementById('navOverlay');
        const siteContainer = document.body;
        const breadcrumbNav = document.getElementById('breadcrumbNav');
        
        // Navigation state management - SIMPLE
        let navState = 'nav-full'; // nav-full or nav-collapsed only
        
        // Get initial state based on screen size and saved preference
        function getInitialNavState() {
            const savedState = localStorage.getItem('navState');
            const screenWidth = window.innerWidth;
            
            if (screenWidth <= 768) {
                return 'nav-collapsed'; // Always start collapsed on mobile
            } else {
                return savedState || 'nav-full'; // Default to full on desktop/tablet
            }
        }
        
        // Set navigation state
        function setNavState(state) {
            // Remove all nav state classes
            siteContainer.classList.remove('nav-full', 'nav-collapsed', 'nav-open');
            
            // Add new state
            siteContainer.classList.add(state);
            
            // On mobile, add nav-open class when showing navigation
            if (window.innerWidth <= 768 && state === 'nav-full') {
                siteContainer.classList.add('nav-open');
            }
            
            navState = state;
            
            // Update toggle button aria-expanded
            const isOpen = state !== 'nav-collapsed';
            navToggle.setAttribute('aria-expanded', isOpen);
            
            // Show/hide breadcrumb navigation
            if (state === 'nav-collapsed') {
                updateBreadcrumb();
                breadcrumbNav.classList.add('visible');
            } else {
                breadcrumbNav.classList.remove('visible');
            }
            
            // Show/hide overlay on mobile
            if (window.innerWidth <= 768) {
                if (state !== 'nav-collapsed') {
                    navOverlay.classList.add('active');
                } else {
                    navOverlay.classList.remove('active');
                }
            }
            
            // Save state (except on mobile where it's always collapsed by default)
            if (window.innerWidth > 768) {
                localStorage.setItem('navState', state);
            }
        }
        
        // Toggle navigation - SIMPLE: just full or hidden
        function toggleNavigation() {
            if (navState === 'nav-collapsed') {
                setNavState('nav-full');
            } else {
                setNavState('nav-collapsed');
            }
        }
        
        // Update breadcrumb navigation
        function updateBreadcrumb() {
            const currentPageTitle = document.title.split(' - ')[0];
            const breadcrumbCurrent = breadcrumbNav.querySelector('.breadcrumb-current');
            if (breadcrumbCurrent) {
                breadcrumbCurrent.textContent = currentPageTitle;
            }
        }
        
        // Event listeners
        navToggle.addEventListener('click', toggleNavigation);
        
        // Close navigation when clicking overlay (mobile)
        navOverlay.addEventListener('click', function() {
            if (window.innerWidth <= 768) {
                setNavState('nav-collapsed');
            }
        });
        
        // Close navigation when clicking a nav link on mobile
        document.addEventListener('click', function(e) {
            if (window.innerWidth <= 768 && e.target.matches('.nav-page, .nav-category-link')) {
                setTimeout(() => setNavState('nav-collapsed'), 150);
            }
        });
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + \ to toggle navigation
            if ((e.ctrlKey || e.metaKey) && e.key === '\\') {
                e.preventDefault();
                toggleNavigation();
            }
            
            // Escape to close navigation
            if (e.key === 'Escape' && navState !== 'nav-collapsed') {
                setNavState('nav-collapsed');
            }
        });
        
        // Handle window resize
        let resizeTimeout;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(function() {
                const newState = getInitialNavState();
                setNavState(newState);
            }, 250);
        });
        
        // Initialize navigation state
        const initialState = getInitialNavState();
        setNavState(initialState);
        
        // Auto-collapse after inactivity (optional reading mode)
        let inactivityTimer;
        function resetInactivityTimer() {
            clearTimeout(inactivityTimer);
            if (window.innerWidth > 768 && navState === 'nav-full') {
                inactivityTimer = setTimeout(() => {
                    if (document.hasFocus()) {
                        setNavState('nav-collapsed');
                    }
                }, 120000); // 2 minutes of inactivity
            }
        }
        
        // Track user activity for auto-collapse (optional feature)
        ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'].forEach(event => {
            document.addEventListener(event, resetInactivityTimer, { passive: true });
        });
        
        resetInactivityTimer();
    });
    </script>
</body>
</html> 